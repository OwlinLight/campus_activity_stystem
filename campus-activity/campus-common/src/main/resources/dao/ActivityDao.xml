<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.zjut.common.dao.ActivityDao">
    <resultMap id="ActivityMap" type="Activity">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="start_time" jdbcType="TIMESTAMP" property="startTime"/>
        <result column="end_time" jdbcType="TIMESTAMP" property="endTime"/>
        <result column="college_id" jdbcType="INTEGER" property="college_id"/>
        <result column="position_id" jdbcType="INTEGER" property="director_id"/>
        <result column="director_id" jdbcType="INTEGER" property="director_id"/>
        <result column="status_id" jdbcType="INTEGER" property="status_id"/>
    </resultMap>
    <sql id="Activity_List">
        activity.id,activity.name,start_time,end_time, college_id,position_id,director_id,status_id
    </sql>
    <select id="listActivityPassed" resultMap="ActivityMap">
        select
        <include refid="Activity_List"/>
        from activity inner JOIN status  on activity.status_id = status.id and result = 'pass'
    </select>
    <select id="listActivityFailed" resultMap="ActivityMap">
        select
        <include refid="Activity_List"/>
        from activity inner JOIN status  on activity.status_id = status.id and result = 'wait'
    </select>
    <select id="getActivity" resultMap="ActivityMap">
        select
        <include refid="Activity_List"/>
        from activity
        where id=#{id}
    </select>
    <insert id="createActivity" parameterType="cn.edu.zjut.common.domain.Activity">
        <!-- selectKey获取新增的主键 -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into activity (name, start_time, end_time,college_id,position_id, director_id, status_id) values (#{name,jdbcType=VARCHAR},
        #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, #{college_id,jdbcType=INTEGER}, #{position_id,jdbcType=INTEGER}, #{director_id,jdbcType=INTEGER}, #{status_id,jdbcType=INTEGER})
    </insert>
    <update id="updateActivity" parameterType="Long">
        update activity
        set
        <if test="name != null">
            name = #{name}
        </if>
        <if test="id != null">
            ,start_time = #{startTime,jdbcType=TIMESTAMP}
        </if>
        <if test="id != null">
            ,end_time = #{endTime,jdbcType=TIMESTAMP}
        </if>
        <if test="college_id != null">
            ,college_id = #{college_id}
        </if>
        <if test="director_id != null">
            ,director_id = #{director_id}
        </if>
        <if test="status_id != null">
            ,status_id = #{status_id}
        </if>
        <if test="position_id != null">
            ,position_id = #{name}
        </if>
        where id=#{id,jdbcType=INTEGER}
    </update>
    <update id="updateStatus" parameterType="cn.edu.zjut.common.domain.Status">
        update activity a,status b set b.result = #{result},
        b.deal_time = #{deal_time} where a.status_id = b.id and a.id = #{activity_id}

    </update>
    <delete id="deleteActivity" parameterType="java.lang.Long">
        delete from activity
        where id=#{id,jdbcType=INTEGER}
    </delete>
</mapper>
